---
layout: none
collection: product
permalink: /academic/product_01
date: 2022-04-31
---


<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>自习室预约小程序｜产品案例</title>
<meta name="description" content="从需求澄清到MVP上线：选座→预约→支付→取消/退款→门禁与能耗联动；含流程图与交互原型。"/>

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true,securityLevel:'loose',theme:'dark'});</script>

<style>
/* ===== 基础主题 & 设计体系 ===== */
:root{
  --bg:#0c0f14;--bg-soft:#111623;--card:#121a2a;--border:#1c2434;
  --text:#e9eef7;--muted:#a5b1c6;--brand:#4f8cff;--ok:#22c55e;--warn:#ffb020;
}
:root[data-theme="light"]{
  --bg:#f6f8fb;--bg-soft:#ffffff;--card:#ffffff;--border:#e6e9f0;
  --text:#0f1729;--muted:#5b6578;--brand:#306cdb;--ok:#199a50;--warn:#b67500;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont,"Segoe UI","PingFang SC","Hiragino Sans GB","Microsoft YaHei", Arial,sans-serif;
  background:radial-gradient(1200px 600px at 20% -10%, rgba(79,140,255,.12), transparent 60%), linear-gradient(180deg,var(--bg) 0%, #0a0d12 100%);
  color:var(--text);
}
a{color:inherit;text-decoration:none}
.container{max-width:1120px;margin:0 auto;padding:28px 16px 72px}

/* ===== 顶部导航 ===== */
.nav{
  position:sticky; top:0; z-index:20; backdrop-filter: blur(8px);
  background:color-mix(in srgb, var(--bg), transparent 30%);
  border-bottom:1px solid var(--border);
}
.nav-inner{display:flex;align-items:center;justify-content:space-between;gap:12px; padding:12px 16px;}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#4f8cff,#7c9dff);display:grid;place-items:center;color:#fff;font-weight:700}
.brand-name{font-weight:700;letter-spacing:.3px}
.nav-links{display:flex;gap:14px;flex-wrap:wrap}
.nav-links a{padding:8px 10px;border-radius:8px;border:1px solid transparent}
.nav-links a:hover{border-color:var(--border);background:color-mix(in srgb, var(--card), transparent 60%)}
.theme-toggle{
  border:1px solid var(--border); background:var(--bg-soft); color:var(--text);
  padding:8px 10px;border-radius:8px;cursor:pointer
}

/* ===== Hero ===== */
.hero{
  display:grid;grid-template-columns:1.4fr 1fr;gap:16px;align-items:center;
  margin-top:18px;padding:22px;border:1px solid var(--border);border-radius:16px;background:var(--bg-soft);
}
.hero h1{margin:0 0 8px;font-size:28px}
.hero p{margin:0;color:var(--muted)}
.tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.tag{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:color-mix(in srgb, var(--card), transparent 50%)}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.kpi{border:1px solid var(--border);background:var(--card);border-radius:12px;padding:14px;text-align:center}
.kpi strong{font-size:20px}

/* ===== Section 卡片 ===== */
.section{margin-top:18px;border:1px solid var(--border);background:var(--bg-soft);border-radius:14px;overflow:hidden}
.section h2{margin:0;padding:18px 18px 8px}
.section .body{padding:0 18px 18px}
.cols{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.list{margin:8px 0 0;padding-left:18px;color:var(--text)}
.muted{color:var(--muted)}

/* ===== 画廊 ===== */
.gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.card{
  border:1px solid var(--border);background:var(--card);border-radius:12px;overflow:hidden
}
.card img{display:block;width:100%;height:220px;object-fit:cover}
.card .cap{padding:8px 10px;color:var(--muted);font-size:12px;border-top:1px solid var(--border)}

/* ===== Mermaid 区（标签切换） ===== */
.tabs{display:flex;gap:8px;flex-wrap:wrap;padding:0 18px 10px}
.tab-btn{border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer}
.tab-btn.active{outline:2px solid color-mix(in srgb, var(--brand), transparent 60%)}
.diagram{display:none;padding:0 18px 18px}
.diagram.active{display:block}
.mermaid{border:1px solid var(--border);border-radius:10px;background:var(--card);padding:10px}

/* ===== Demo 预览 ===== */
.demo{
  display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start
}
.iframe-wrap{
  border:1px solid var(--border);border-radius:16px;background:var(--card);padding:12px
}
iframe.phone{width:100%;height:820px;border:0;border-radius:12px;background:#0b0c10}
.demo-ops{display:flex;gap:10px;margin-top:8px}
.btn{border:1px solid var(--border);background:var(--card);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer}
.btn:hover{background:color-mix(in srgb, var(--card), transparent 40%)}

/* ===== Footer ===== */
footer{margin-top:26px;color:var(--muted);text-align:center}

/* ===== 响应式 ===== */
@media (max-width:1020px){
  .hero{grid-template-columns:1fr}
  .kpis{grid-template-columns:repeat(3,1fr)}
  .demo{grid-template-columns:1fr}
}
@media (max-width:800px){
  .cols{grid-template-columns:1fr}
  .gallery{grid-template-columns:repeat(2,1fr)}
}
@media (max-width:580px){
  .gallery{grid-template-columns:1fr}
}
</style>
</head>
<body>
  <!-- 顶部导航 -->
  <div class="nav">
    <div class="nav-inner container">
      <div class="brand">
        <div class="logo">书</div>
        <div class="brand-name">自习室预约｜案例</div>
      </div>
      <div class="nav-links">
        <a href="#about">概览</a>
        <a href="#diagrams">流程图</a>
        <a href="#gallery">原型图</a>
        <a href="#demo">交互演示</a>
      </div>
      <button class="theme-toggle" id="themeBtn">切换主题</button>
    </div>
  </div>

  <div class="container">
    <!-- Hero -->
    <section class="hero" id="about">
      <div>
        <h1>把“闲置教室”做成可预约的自习空间</h1>
        <p class="muted">从一品威客接单，3人小团队，2–3个月上线 MVP；选座→预约→支付→取消/退款→门禁联动。</p>
        <div class="tags">
          <span class="tag">需求澄清</span><span class="tag">MVP</span><span class="tag">支付回调&幂等</span>
          <span class="tag">Redis 并发锁</span><span class="tag">门禁/灯控</span>
        </div>
      </div>
      <div class="kpis">
        <div class="kpi"><div>预约率</div><strong>18% → 62%</strong></div>
        <div class="kpi"><div>退款率</div><strong>≈ 5%</strong></div>
        <div class="kpi"><div>7日留存</div><strong>&gt; 50%</strong></div>
      </div>
    </section>

    <!-- 项目简介 -->
    <section class="section">
      <h2>项目简介</h2>
      <div class="body cols">
        <div class="card" style="padding:16px;">
          <h3>我做了什么</h3>
          <ul class="list">
            <li>把模糊诉求拆成“正向/反向/异常兜底”三条主线。</li>
            <li>确定关键机制：双阶段锁、回调为准、幂等、定时补偿。</li>
            <li>组织评审与测试验收，上线监控与复盘迭代。</li>
          </ul>
        </div>
        <div class="card" style="padding:16px;">
          <h3>范围与边界</h3>
          <ul class="list">
            <li>学生端：选座/预约/支付/订单/开门。</li>
            <li>后台：座位&库存、订单与对账、退款。</li>
            <li>二期体验：最近一次选择记忆（低成本高收益）。</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 流程图（多标签） -->
    <section class="section" id="diagrams">
      <h2>流程图</h2>
      <div class="tabs">
        <button class="tab-btn active" data-tab="d1">正向预约（端到端）</button>
        <button class="tab-btn" data-tab="d2">反向取消与退款</button>
        <button class="tab-btn" data-tab="d3">到店开门与能耗联动</button>
        <button class="tab-btn" data-tab="d4">定时任务/补偿与对账</button>
      </div>

      <!-- D1 正向预约 -->
      <div class="diagram active" id="d1">
        <pre class="mermaid">
sequenceDiagram
    autonumber
    participant U as 用户
    participant MP as 小程序
    participant RS as 预约服务
    participant INV as 库存/排程(Redis+MySQL)
    participant PS as 微信支付

    U->>MP: 登录并选择门店/日期/时段/座位
    MP->>RS: 查询可用座位
    RS->>INV: 读可用池(余量/禁用/热度)
    INV-->>RS: 返回座位状态
    RS-->>MP: 渲染座位图

    U->>MP: 提交订单
    MP->>RS: 创建草稿
    RS->>INV: 写预占锁(TTL≈30s, token)
    alt 冲突
      RS-->>MP: 座位被占,请重选
    else 预占成功
      MP->>PS: 发起微信支付(签名+幂等key)
      PS-->>MP: 同步提示(以回调为准)
      PS-->>RS: 异步回调(<=30s,可重试)
      RS->>RS: 幂等校验
      alt 回调成功
        RS->>INV: 升级为订单锁(≈15min)
        RS->>INV: 落库订单(已支付)
        RS-->>MP: 返回成功凭证
      else 回调失败/超时
        RS->>INV: 释放预占锁
        RS-->>MP: 支付失败,可重试
      end
    end
        </pre>
      </div>

      <!-- D2 反向取消 -->
      <div class="diagram" id="d2">
        <pre class="mermaid">
sequenceDiagram
    autonumber
    participant U as 用户
    participant MP as 小程序
    participant RS as 预约服务
    participant INV as 库存/排程
    participant PS as 微信支付

    U->>MP: 订单页选择"取消预约"
    MP->>RS: 取消申请(订单号+原因)
    RS->>INV: 读订单状态/时间窗

    alt 未支付/草稿
      RS->>INV: 直接关闭订单并释放预占
      RS-->>MP: 取消成功(无退款)
    else 已支付
      RS->>RS: 计算应退(规则: 开始前X小时全额/部分/不退)
      RS->>PS: 发起原路退款(带幂等key)
      PS-->>RS: 退款异步回调(可重试)
      alt 退款成功
        RS->>INV: 标记订单"已退款"并释放锁/库存
        RS-->>MP: 展示退款成功
      else 退款失败
        RS->>RS: 写入重试队列&告警
        RS-->>MP: 已受理,预计1-3工作日(后台重试)
      end
    end
        </pre>
      </div>

      <!-- D3 开门与能耗 -->
      <div class="diagram" id="d3">
        <pre class="mermaid">
sequenceDiagram
    autonumber
    participant U as 用户
    participant MP as 小程序
    participant RS as 预约服务
    participant G as 门禁网关
    participant L as 灯控/能耗

    U->>MP: 到店点击"开门"
    MP->>RS: 请求开门(订单号+设备ID)
    RS->>RS: 校验(已支付/时间窗/黑白名单)
    alt 校验通过
      RS->>G: 下发开门指令(TTL=5s, traceId)
      G-->>RS: 回执(成功/失败)
      RS-->>MP: 回显结果
      par 联动
        RS->>L: 开灯/计量开始
        L-->>RS: 回执(允许延迟)
      and 记录
        RS->>RS: 写入进出记录/状态迁移
      end
    else 校验失败
      RS-->>MP: 拒绝开门(原因提示)
    end
        </pre>
      </div>

      <!-- D4 定时任务/补偿与对账 -->
      <div class="diagram" id="d4">
        <pre class="mermaid">
flowchart TD
    subgraph Scheduler[定时任务/补偿]
      A[关单任务<br/>>15min 未支付] -->|释放预占| B[库存回滚]
      C[退款补偿队列] -->|重试策略/退避| D[调用支付退款API]
      D -->|成功| E[订单标记已退款]
      D -->|失败| C
    end
    subgraph Finance[对账]
      F[每日对账拉单] --> G{平台流水一致?}
      G -->|是| H[对账通过]
      G -->|否| I[差异分析+报警+人工处理]
    end
    B --> Finance
    E --> Finance
        </pre>
      </div>
    </section>

    <!-- 原型图画廊（替换为你的图片） -->
    <section class="section" id="gallery">
      <h2>产品原型图</h2>
      <div class="body gallery">
        <div class="card"><img src="images/studyroom/01-home.png" alt="首页"/><div class="cap">首页/推荐</div></div>
        <div class="card"><img src="images/studyroom/02-seat.png" alt="选座"/><div class="cap">选座页</div></div>
        <div class="card"><img src="images/studyroom/03-order.png" alt="确认"/><div class="cap">订单确认</div></div>
        <div class="card"><img src="images/studyroom/04-pay.png" alt="支付"/><div class="cap">支付页</div></div>
        <div class="card"><img src="images/studyroom/05-orders.png" alt="订单列表"/><div class="cap">我的订单</div></div>
        <div class="card"><img src="images/studyroom/06-refund.png" alt="取消退款"/><div class="cap">取消/退款</div></div>
      </div>
      <div class="body muted" style="margin-top:8px">把路径替换为你的真实图片；若无图可暂留占位。</div>
    </section>

    <!-- 交互前端演示（外部文件 app.html） -->
    <section class="section" id="demo">
      <h2>交互演示（前端模拟）</h2>
      <div class="body demo">
        <div class="card" style="padding:16px">
          <h3>说明</h3>
          <ul class="list">
            <li>此处通过 <code>&lt;iframe&gt;</code> 加载你提供的前端原型（<strong>app.html</strong>）。</li>
            <li>这样既隔离样式脚本，又能在页面内完整预览。</li>
            <li>如需 100% 单文件，可把 <code>app.html</code> 内容复制为 <code>srcdoc</code>。</li>
          </ul>
          <div class="demo-ops">
            <button class="btn" id="reloadBtn">重载</button>
            <button class="btn" id="openBtn">新窗口打开</button>
          </div>
        </div>
        <div class="iframe-wrap">
          <iframe class="phone" id="phoneFrame" title="交互原型预览" src="app.html"></iframe>
        </div>
      </div>
    </section>

    <footer>© 你的名字 — 自习室预约产品案例</footer>
  </div>

<script>
/* 主题切换 */
const themeBtn = document.getElementById('themeBtn');
themeBtn.addEventListener('click',()=>{
  const html=document.documentElement;
  const next = html.getAttribute('data-theme')==='dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  mermaid.initialize({startOnLoad:true,securityLevel:'loose',theme: next==='dark'?'dark':'default'});
  // 触发重绘以适配新主题
  document.querySelectorAll('.mermaid').forEach(el=>{
    el.removeAttribute('data-processed'); el.innerHTML = el.textContent; // reset
  });
  mermaid.init(undefined, document.querySelectorAll('.mermaid'));
});

/* 标签切换（流程图） */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const id = btn.getAttribute('data-tab');
    document.querySelectorAll('.diagram').forEach(d=>d.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    // 重新渲染可见 mermaid
    const block = document.getElementById(id).querySelector('.mermaid');
    if(block){ block.removeAttribute('data-processed'); block.innerHTML = block.textContent; mermaid.init(undefined,[block]); }
  });
});

/* Demo 控件 */
const frame = document.getElementById('phoneFrame');
document.getElementById('reloadBtn').addEventListener('click',()=>{ frame.src = frame.src; });
document.getElementById('openBtn').addEventListener('click',()=>{ window.open('app.html','_blank'); });
</script>
</body>
</html>
